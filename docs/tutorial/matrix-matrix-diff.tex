\subsection{Matrix-Matrix Derivatives}
\label{subsec:mat_mat_diff}

\begin{frame}
\frametitle{Matrix-Matrix Derivatives}
\framesubtitle{Why}
%
\begin{center}
\vspace{-40pt}
\colorbox{green!10}{\vbox{
Derivative is the rate of change of $\color{m1}\mF(\mX)$ w.r.t each 
$\color{m1}x_{ij}$
}}
\end{center}
%
Scalar-matrix derivative of $\color{m1}f(\mG(\mX))$ requires
the information in the matrix-matrix derivative $\color{m1}
\frac{\partial\mG}{\partial\mX}$. For example:

\begin{itemize}
  \item 
    $\color{m1} \trace \left(\left(\left(\mI+\mX\right)^{-1}\right)\mX\right)$
\end{itemize}
%
\begin{center}
Desiderata: The derivative of a matrix-matrix function should be a matrix, so
that a convenient chain-rule can be established.
\end{center}
%
\end{frame}

\begin{frame}
\frametitle{Matrix-Matrix Derivative}
\framesubtitle{The Arrangement Problem}
%
\begin{itemize}
\item For 
  $\color{m1}\mF(\mX)=\mY; \mX\in{}\R^{m\times{}n}, \mY\in{}\R^{k\times{}l},
  \mF'(\mX) \in{} \R^{mn\times{}kl}$
  \begin{itemize}
    \item $\color{m1}\mF'(\mX)$ is a 4-D structure.
    \item How do you represent $\color{m1}\mF'(\mX)$ in 2-D?
  \end{itemize}
\end{itemize}
%
\vspace{-20pt}
\textcolor{blue}{
\begin{align*}
\mF(\mX) &= \mX \\
\mF'
\begin{pmatrix} 
  x_{11} & x_{12} \\
  x_{21} & x_{22} 
\end{pmatrix}
&=
\begin{pmatrix}
\begin{pmatrix} 1 & 0 \\ 0 & 0 \end{pmatrix} &
\begin{pmatrix} 0 & 1 \\ 0 & 0 \end{pmatrix} \\
\begin{pmatrix} 0 & 0 \\ 1 & 0 \end{pmatrix} &
\begin{pmatrix} 0 & 0 \\ 0 & 1 \end{pmatrix} \\
\end{pmatrix}
\end{align*}
} % textcolor
\vspace{-20pt}
%
\begin{center}
  \textcolor{red}{$\mF'(\mX)$ does not have nice structure\!}
\end{center}
%
\end{frame}

\begin{frame}
\frametitle{Matrix-Matrix Derivatives}
\framesubtitle{The vec Operator}
%
\begin{center}
For $\color{m1}\mA\in \R^{m\times n}$, $\color{m1} \myvec(\mA)$  is the
column-stacked vector of $\color{m1}\mA$
\end{center}
%
$$\color{m1}
\myvec(\mA) = 
\begin{pmatrix} 
a_{11} \\
a_{21} \\
\vdots \\
a_{m1} \\
a_{12} \\
\vdots \\
a_{mn} \\
\end{pmatrix}
$$
\end{frame}

\begin{frame}
\frametitle{The Matrix-Matrix Derivative}
\framesubtitle{Definition}
%
We define the matrix--matrix derivative to be: 
%
$$\color{m1}
\frac{\partial \mF}{\partial \mX} \stackrel{\mathrm{def}}{=} 
\frac{\partial
  \myvec(\mF^\top)}{\partial \myvec^\top(\mX^\top)} = 
\begin{pmatrix} 
\frac{\partial \alert<3>{f_{11}}}{\partial \alert<2>{x_{11}}} &
\frac{\partial f_{11}}{\partial \alert<2>{x_{12}}} & \cdots & 
\frac{\partial f_{11}}{\partial \alert<2>{x_{mn}}}\\
\frac{\partial \alert<3>{f_{12}}}{\partial x_{11}} &
\frac{\partial f_{12}}{\partial x_{12}} & \cdots & 
\frac{\partial f_{12}}{\partial x_{mn}}\\
\vdots & \vdots & \ddots & \vdots \\
\frac{\partial \alert<3>{f_{kl}}}{\partial x_{11}} &
\frac{\partial f_{kl}}{\partial x_{12}} & \cdots & 
\frac{\partial f_{kl}}{\partial x_{mn}}
\end{pmatrix}.
$$
%\onslide<4>{
%Caveat: The matrix--matrix derivative of a scalar--matrix function
%is not the same as the scalar--matrix derivative:
%$$\color{m1}
%\frac{\partial\;\mbox{mat}(f)}{\partial\mX} = \myvec^\top\left(
%\left( \frac{\partial f}{\partial\mX}\right)^\top
%\right) .
%$$}
\begin{itemize}
\item This rule seems arcane at first.
\begin{itemize}
\item Results derivatives being well-behaved matrices.
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Matrix-Matrix Derivative}
\framesubtitle{The Arrangement Problem ($\mF(\mX) = \mX$)}
%
\footnotesize
\textcolor{blue}{
\begin{align*}
\mF'
\begin{pmatrix} 
  x_{11} & x_{12} \\
  x_{21} & x_{22} 
\end{pmatrix}
=
\frac{\partial \myvec(\mF^\top)}{\partial \myvec^\top(\mX^\top)}
&= 
\frac{\begin{pmatrix} x_{11} \\ x_{12} \\ x_{21} \\ x_{22} \end{pmatrix}}
{\begin{pmatrix} x_{11} & x_{12} & x_{21} & x_{22} \end{pmatrix}} \\
%
&= 
\begin{pmatrix} 
  1 & 0 & 0 & 0 \\
  0 & 1 & 0 & 0 \\
  0 & 0 & 1 & 0 \\
  0 & 0 & 0 & 1 \\
\end{pmatrix} \\
&= \mI_{d^2\times{}d^2} \\
&= \mI_{d\times{}d}\otimes{}\mI_{d\times{}d}
\end{align*}
} % textcolor
\normalsize
\end{frame}

\input{direct-matrix-pdt}
